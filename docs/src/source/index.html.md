---
title: Swapperd

language_tabs:
  - shell

toc_footers:
  - <a href='https://github.com/renproject/swapperd'>GitHub</a>
  - <a href='https://renproject.com'>Built by Republic Protocol</a>

search: true
---

# Introduction

Welcome to Swapperd! You can use Swapperd to execute cross-chain atomic swaps between Bitcoin, Ethereum, and ERC20 tokens.

# Installation

> Swapperd currently supports macOS, Ubuntu and Windows. Run the following command in a terminal:

```shell
curl https://releases.renproject.com/swapperd/install.sh -sSf | sh
```

Swapperd installs itself as a system service. In the event of an unexpected shutdown, Swapperd will automatically restart and on the first http request it will resume all pending atomic swaps.

A `mnemonic` will be generated during the installation process. Swapperd uses this `mnemonic`, with the `password` the user provides in a swap request, to generate its Bitcoin and Ethereum private keys on-demand.

<aside class="success">
Swapperd never stores private keys to persistent storage. 
</aside>

<aside class="notice">
Backup the <code>mnemonic</code> generated during installation. Forgetting this could result in the loss of funds!
</aside>

# Authentication

> An example using HTTP Authentication:

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:17927/balances
```

Swapperd protects itself using HTTP Basic Authentication. All the HTTP endpoints are protected.

<aside class="success">
Every <code>password</code> that you enter will give you a different keypair for Ethereum and Bitcoin. There is no concept of a wrong password in Swapperd. This helps us to support multiple accounts, and protecting the user from the rubber hammer attack. 
</aside>

# Networks

Swapperd runs on two ports by default, <code>Mainnet</code> on 7927 and <code>Testnet</code> on 17927. We are working on adding a local environment, which will setup local swapperd and blockchain nodes for testing. This <code>Local</code> network would be using 27927.

# Swaps

Executing an atomic swap requires two parties to participate in an interactive swapping process. This interactive swapping process will either result in both parties exchanging their tokens, or both parties keeping their tokens.

Before beginning an atomic swap, it is assumed that the two parties:

1. Agree that one party will begin the atomic swap.  
2. Exchange their Swapperd addresses for the relevant tokens.

Before responding to an atomic swap, it is assumed that the two parties:

1. Exchange the `timeLock` and `secretHash` generated by the party that begins the atomic swap.

All other interactions are handled by Swapperd. Swapperd is built to be fault-tolerant and in the event of unexpected shutdown, or unexpected errors, it will resume and retry actions as needed. All actions are idempotent and cannot result in an accidental double execution.

<aside class="notice">
Swapperd cannot execute the interactive swapping process when the host machine is shutdown, or offline. Keeping the host machine shutdown, or offline, for more than 24 hours could result in the loss of funds!
</aside>

## Beginning an atomic swap

> Beginning an atomic swap by initiating first:

```shell
curl -i      \
     -X POST \
     -d '{
          "sendToken":"BTC",
          "receiveToken":"ETH",
          "sendAmount":"20000",
          "receiveAmount":"20000000000000000",
          "sendTo":"n2RcTmQu2PoRcfHn7uyfQ2jWVcmuHDQLnh",
          "receiveFrom":"0x780c6d20b6C59F4b5F3658A66E1e8ef22d61725D",
          "shouldInitiateFirst":true
        }' \
     http://username:password@localhost:17927/swaps
```

> The response body is structured like this:

```json
{
	"id": "c7t5VHbJdx2M0PtRS6G3lN2nrRH1fX0arUoZYkFBlvI=",
	"swap": {
      "sendToken": "ETH",
      "receiveToken": "BTC",
      "sendAmount": "20000000000000000",
      "receiveAmount": "20000",
      "sendTo": "0x5Ea5F67cC958023F2da2ea92231d358F2a3BbA47",
      "receiveFrom": "mzKgUBHX7xSkKiNrdnxTe6fJKAcvFri2Tc",
      "timeLock": 1548669277,
      "secretHash": "3YyU0uyS2TKWdAkVQpQWwTXRXcEkpjpya8atI2x+OTE=",
      "shouldInitiateFirst": false,
  },
	"signature": "qruvrzo2hpyCp76wdcmpo+E+5fZ42n2MNyA4sOjSCzgr8rYh4tLZ0vpKrGDqYptOXzYpakC+NKgPO51hFM7L4AE="
}
```

The beginning party sends a HTTP request to his Swapperd using the agreed addresses.

Swapperd will validate the request and generate the responding swap object. The begining party can send this response to the responding party. The responding party can check KYC (if they require it), by using the signature. Then they could start the responding swap with the given swap object.

The begining party can check the status of their swap using the <code>id</code> returned by the swapperd.

## Responding to an atomic swap

> Respond to an atomic swap by initiating second:

```shell
curl -i      \
     -X POST \
     -d '{
        "sendToken": "ETH",
        "receiveToken": "BTC",
        "sendAmount": "20000000000000000",
        "receiveAmount": "20000",
        "sendTo": "0x5Ea5F67cC958023F2da2ea92231d358F2a3BbA47",
        "receiveFrom": "mzKgUBHX7xSkKiNrdnxTe6fJKAcvFri2Tc",
        "timeLock": 1548669277,
        "secretHash": "3YyU0uyS2TKWdAkVQpQWwTXRXcEkpjpya8atI2x+OTE=",
        "shouldInitiateFirst": false,
    }' \
    http://username:password@localhost:17927/swaps
```

> The response body is structured like this:

```json
{
  "id": "S1Jn5MTLBqD8M2lm6vYjt1n2qy7XlW7sjHyIY3eInNA=",
}
```

After receiving the response from the begining party (and checking the KYC information if required), the responding party sends the swap object they received to their swapperd.

## Get atomic swap receipts

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:17927/swaps
```

> The response body is structured like this:

```json
{
  "swaps": [
    {
      "id": "DiqkYPg/2mCzGhlk7ENighXhFDSkSYJ9+qmmVHI3UrE=",
      "sendToken": "BTC",
      "receiveToken": "ETH",
      "sendAmount": "20000",
      "receiveAmount": "2000000000000",
      "sendCost": {
        "BTC": "0"
      },
      "receiveCost": {
        "ETH": "0"
      },
      "timestamp": 1548656666,
      "timeLock": 1548678266,
      "status": 5,
      "delay": false,
      "active": true
    }
  ]
}
```

# Balances

## Get balances

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:17927/balances
```

> The response body is structured like this:

```json
{
	"BTC": {
	"address": "mzKgUBHX7xSkKiNrdnxTe6fJKAcvFri2Tc",
	"decimals": 8,
	"balance": "19190614"
	},
	"WBTC": {
	"address": "0x5Ea5F67cC958023F2da2ea92231d358F2a3BbA47",
	"decimals": 18,
	"balance": "0"
  }
}
```

## Get balances of a particular token

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:17927/balances
```

### HTTP Request

`GET http://localhost:17927/balances`

<aside class="success">
This is a protected HTTP endpoint.
</aside>

# Transfers

## Transferring funds

```shell
curl -i      \
     -X POST \
     -d '{ "to": "mv1Pb8Ed7MA2wegbJQLZS3GzNHe9rpTBGK",
           "token": "BTC",
           "amount": "100000000" }' \
     http://username:password@localhost:17927/transfers
```

> The response body is structured like this:

```json
{}
```

### HTTP Request

`POST http://localhost:17927/withdrawals`

<aside class="success">
This is a protected HTTP endpoint.
</aside>

# Info

## Getting information about Swapperd

```shell
curl -i     \
     -X GET \
     http://username:password@localhost:17927/info
```

> The response body is structured like this:

```json
{
    "version": "1.0.0",
    "bootloaded": true,
    "supportedBlockchains": null,
    "supportedTokens": [
        {
            "name": "BTC",
            "decimals": 8,
            "blockchain": "bitcoin"
        },
        {
            "name": "ETH",
            "decimals": 18,
            "blockchain": "ethereum"
        },
        {
            "name": "WBTC",
            "decimals": 8,
            "blockchain": "erc20"
        }
    ]
}
```

### HTTP Request

`GET http://localhost:17927/whoami`

<aside class="notice">
This is not a protected HTTP endpoint.
</aside>

# Errors

Swapperd uses the following error codes:

Error Code | Meaning
---------- | -------
400 | Bad Request -- The request is invalid.
401 | Unauthorized -- The username or password is invalid.
404 | Not Found -- The HTTP endpoint or method is invalid.
500 | Internal Server Error -- Swapperd has encountered an unexpected error. Please submit a bug report!
